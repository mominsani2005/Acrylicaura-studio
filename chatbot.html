<!-- ========================= -->
<!-- ğŸ”¹ Upgraded Chatbot Start -->
<!-- ========================= -->
<div id="chatbot" class="fixed bottom-6 right-6 z-[9999]">

  <button id="chatBtn" onclick="toggleChat()"
    class="w-16 h-16 rounded-full
    bg-gradient-to-br from-pink-400 to-purple-500
    text-white text-2xl shadow-2xl hover:scale-110 transition-transform duration-300 animate-bounce">
    ğŸ’¬
  </button>

  <div id="chatbox"
    class="hidden mt-4 w-80 sm:w-72 md:w-80 rounded-3xl p-4
    bg-white/95 backdrop-blur-3xl border border-purple-200 shadow-2xl animate-fadeIn">

    <h3 class="font-bold text-purple-600 text-lg mb-2">Acrylicaura Assistant âœ¨</h3>
    <div id="messages" class="space-y-2 text-sm text-gray-800 mb-3 max-h-60 overflow-y-auto"></div>

    <div class="flex gap-2">
      <input type="text" id="userInput" placeholder="Type message..."
        class="flex-1 p-2 rounded-xl border border-purple-200 focus:outline-none focus:ring-2 focus:ring-purple-300">
      <button onclick="sendUserMsg()"
        class="px-3 py-2 bg-purple-500 text-white rounded-xl hover:bg-purple-600 transition">Send</button>
    </div>

    <div id="quickReplies" class="mt-2 flex flex-wrap gap-2"></div>

    <div id="orderPreview" class="mt-3 p-2 bg-purple-50 rounded-xl text-purple-700 text-sm hidden"></div>

  </div>
</div>

<style>
@keyframes fadeIn { from {opacity:0; transform:translateY(20px);} to {opacity:1; transform:translateY(0);} }
.animate-fadeIn { animation: fadeIn 0.5s ease-out; }
#messages::-webkit-scrollbar { width: 6px; }
#messages::-webkit-scrollbar-thumb { background: rgba(199,91,161,0.5); border-radius: 3px; }
#messages::-webkit-scrollbar-track { background: transparent; }
.msg-img { width: 60px; border-radius: 12px; margin-top:4px; }
</style>

<script>
/* ================= DAY 30 â€“ VISITOR COUNTER ================= */
let visits = localStorage.getItem("acrylicauraVisits") || 0;
localStorage.setItem("acrylicauraVisits", ++visits);

/* ================= DAY 29 â€“ SILENT SESSION CHECK ================= */
const userSession = JSON.parse(localStorage.getItem("userSession"));
if(!userSession){
  location.href = "login.html";
}

// --- Chatbot Logic ---
const giftCatalog = {
  "Photo Frame":{img:"https://images.unsplash.com/photo-1607082348824-028a3971e4b5?auto=format&fit=crop&w=200&q=60", base:500},
  "Name Plate":{img:"https://images.unsplash.com/photo-1613478324263-f4290f2853c2?auto=format&fit=crop&w=200&q=60", base:700},
  "Moon Lamp":{img:"https://images.unsplash.com/photo-1607082348801-1a13b37a4e34?auto=format&fit=crop&w=200&q=60", base:1200},
  "Resin Gift":{img:"https://images.unsplash.com/photo-1607082348808-623e6c488b95?auto=format&fit=crop&w=200&q=60", base:650},
  "Custom Mug":{img:"https://images.unsplash.com/photo-1607082348796-8a331bc4cf60?auto=format&fit=crop&w=200&q=60", base:400},
  "Couple Gift":{img:"https://images.unsplash.com/photo-1607082348805-f88ff6f4e1b2?auto=format&fit=crop&w=200&q=60", base:800},
  "Birthday/Anniversary":{img:"https://images.unsplash.com/photo-1607082348799-93b2f8b6db36?auto=format&fit=crop&w=200&q=60", base:900}
};

const materials = ["Acrylic","Wood","Metal"];
const sizes = ["Small","Medium","Large"];

let order = JSON.parse(localStorage.getItem("chatOrder")) || {gift:null, material:null, size:null, msg:null, price:0};

function toggleChat(){ document.getElementById("chatbox").classList.toggle("hidden"); }

function addMessage(text,isBot=true,imgUrl=null){
  const box=document.getElementById("messages");
  const msg=document.createElement("div");
  msg.className=isBot?"bg-purple-50 p-2 rounded-xl":"bg-purple-200 p-2 rounded-xl text-right";
  msg.innerText=text;
  if(imgUrl){
    const img=document.createElement("img");
    img.src=imgUrl;
    img.className="msg-img mt-1";
    msg.appendChild(document.createElement("br"));
    msg.appendChild(img);
  }
  box.appendChild(msg);
  box.scrollTop=box.scrollHeight;
}

function showQuickReplies(options){ 
  const container=document.getElementById("quickReplies");
  container.innerHTML=""; 
  options.forEach(opt=>{
    const btn=document.createElement("button");
    btn.className="px-3 py-1 bg-purple-200 text-purple-800 rounded-xl hover:bg-purple-300 transition";
    btn.innerText=opt;
    btn.onclick=()=> handleQuickReply(opt);
    container.appendChild(btn);
  });
}

function updateOrderPreview(){
  const preview=document.getElementById("orderPreview");
  if(order.gift){
    preview.innerHTML=`Selected: ${order.gift} | Material: ${order.material || '-'} | Size: ${order.size || '-'} | Price: â‚¹${order.price}`;
    preview.classList.remove("hidden");
  } else preview.classList.add("hidden");
}

function handleQuickReply(opt){
  if(!order.gift){
    order.gift=opt;
    order.price=giftCatalog[opt].base;
    addMessage(`You selected ${opt}`);
    showQuickReplies(materials);
  }
  else if(!order.material){
    order.material=opt;
    order.price*=1.2;
    addMessage(`Material chosen: ${opt}`);
    showQuickReplies(sizes);
  }
  else if(!order.size){
    order.size=opt;
    addMessage(`Size chosen: ${opt}`);
    localStorage.setItem("chatOrder",JSON.stringify(order));
    updateOrderPreview();
    showQuickReplies([]);
    addMessage("âœ… Order saved. You can continue to checkout!");
  }
  updateOrderPreview();
}

function sendUserMsg(){ 
  const input=document.getElementById("userInput"); 
  const text=input.value.trim(); 
  if(!text) return; 
  addMessage(text,false); 
  input.value=""; 
}

window.addEventListener("load",()=>{
  addMessage("Hello! Select a gift to start ğŸ");
  showQuickReplies(Object.keys(giftCatalog));
  updateOrderPreview();
});
</script>
<!-- ========================= -->
<!-- ğŸ”¹ Upgraded Chatbot End -->
<!-- ========================= -->
